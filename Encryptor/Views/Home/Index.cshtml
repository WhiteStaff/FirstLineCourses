@using System.Web.UI.WebControls
@{
    ViewBag.Title = "Home Page";
}

<div class="jumbotron">
    <h1>Шифратор вижинера</h1>
</div>
<script type="text/javascript">
    function validateFileSize() {
        var uploadControl = document.getElementById('file');
        if (uploadControl.files[0].size > 314572800‬)
    {
        document.getElementById('dvMsg').style.display = "block";
        document.getElementById('uploadBtn').disabled = true;
        return false;
    }
    else
    {
        document.getElementById('dvMsg').style.display = "none";
        document.getElementById('uploadBtn').disabled = false;
        return true;
    }
    }

</script>
<div class="row">
    <ul class="nav nav-tabs  " id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true" aria-expanded="true">Текст</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Файл</a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade @ViewBag.firstActive" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="container">
                @using (Html.BeginForm("Send", "Home", FormMethod.Post))
                {
                    <div class="row" style="margin-top: 5px">
                        <label>Текст</label>
                        <textarea name="text" class="form-control rounded-0 mb-3" id="exampleFormControlTextarea1" rows="10" maxlength="20000" required>@ViewBag.text</textarea>
                    </div>
                    <div class="row" style="margin-top: 5px;">
                        <div class="col-lg-4" style="padding-left: 0 !important">
                            <label>Ключ</label>
                            <input name="key" placeholder="Введите ключ" pattern="^[А-Яа-яЁё]+$" class="form-control" required title="Допустимы только русские буквы" value="@ViewBag.key"/>
                        </div>
                        <div class="col-lg-2" style="height: 100%">
                            <div class="radio">
                                <label><input name="isEncrypted" value="true" type="radio" checked="checked">Расшифровать</label>
                            </div>
                            <div class="radio">
                                <label><input name="isEncrypted" value="false" type="radio">Зашифровать</label>
                            </div>
                        </div>
                        <div class="col-lg-4" style="padding-right: 0">
                            @if (ViewBag.Save)
                            {
                            <div class="form-inline">

                                <input name="fileName" width="300px" placeholder="Название файла" class="form-control" />
                                <input type="submit" class="btn  btn-secondary" value="Сохранить результат" name="action" />
                                <span>По умолчанию название NoName</span>
                            </div>
                            }
                        </div>
                        <div class="col-lg-2 text-right " style="padding-right: 0 !important">
                            <input type="submit" class="btn  btn-secondary" value="Рассчитать" name="action"/>

                        </div>
                    </div>
                    <div class="row" style="margin-top: 5px">
                        <label>Результат</label>
                        <div style="min-height: 300px">
                            <span style="white-space: pre-line">@ViewBag.result</span>
                        </div>
                    </div>
                }
            </div>
        </div>
        <div class="tab-pane fade @ViewBag.secondActive" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <h3>Выберите .docx файл для загрузки размером не более 300МБ</h3>
            @using (Html.BeginForm("Upload", "Home", FormMethod.Post, new {enctype = "multipart/form-data"}))
            {
                <div class="row">
                    <div class="col-lg-4">
                        <div>
                            <input type="file" name="upload" accept="application/vnd.openxmlformats-officedocument.wordprocessingml.document" onchange="validateFileSize();" id="file"/>
                            <span id="dvMsg" class="field-validation-error" id="errorMessagefile" style="display: none">Максимальный размер 100Мб</span>
                        </div>
                        <button type="submit" class="btn btn-secondary" style="margin-top: 5px" id="uploadBtn">Загрузить</button>
                    </div>
                    <div class="col-lg-4">
                        <label>Ключ</label>
                        <input name="key" placeholder="Введите ключ" pattern="^[А-Яа-яЁё]+$" class="form-control" required title="Допустимы только русские буквы" value="@ViewBag.key"/>
                        <div class="radio">
                            <label><input name="isEncrypted" value="true" type="radio" checked="checked">Расшифровать</label>
                        </div>
                        <div class="radio">
                            <label><input name="isEncrypted" value="false" type="radio">Зашифровать</label>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <label>Название нового файла</label>
                        <input name="name" placeholder="По умолчанию название исходного" class="form-control" value="@ViewBag.name"/>
                    </div>
                </div>

                if (@ViewBag.error)
                {
                    <hgroup>
                        <h1>Ошибка.</h1>
                        <h2>При обработке последнего загруженного файла произошла ошибка.</h2>
                    </hgroup>
                }
            }
        </div>
    </div>

</div>